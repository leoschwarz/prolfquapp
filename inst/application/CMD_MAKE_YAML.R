# generates template yaml file
if (!require("optparse", quietly = TRUE)) {
  install.packages("optparse", dependencies = TRUE)
}


option_list <- list(
  make_option(c("-t","--trans"), type = "character", default = "vsn",
                help = "normalization method to use, vsn, none, or robscale",
                metavar = "character"),
  make_option(c("-d", "--outdir"), type = "character", default = ".",
              help = "folder write yaml file to",
              metavar = "string"),
  make_option(c("-y", "--yaml"), type = "character", default = "config.yaml",
              help = "yaml configuration file name",
              metavar = "character"),
  make_option(c("-w", "--workunit"), type = "character", default = "",
              help = "workunit ID",
              metavar = "character"),
  make_option(c("-o", "--order"), type = "character", default = "",
              help = "order ID",
              metavar = "character"),
  make_option(c("-p", "--project"), type = "character", default = "",
              help = "project ID",
              metavar = "character"),
  make_option(c("-s", "--software"), type = "character", default = "DIANN",
              help = "either DIANN, FP_TMT, MAXQUANT",
              metavar = "character")

)

parser <- optparse::OptionParser(usage = "%prog --trans vsn --workunit WUID332211", option_list = option_list)
arguments <- optparse::parse_args(parser, positional_arguments = TRUE)


#parser <- OptionParser(usage = "%prog [options] file", option_list = option_list)
#arguments <- parse_args(parser, args = "test.yml", positional_arguments = TRUE)
lobstr::tree(arguments)


opt <- arguments$options
ymlfile <- arguments$args
ymlfile <- if ( length(ymlfile) == 0 ) { opt$yaml } else {ymlfile}

logger::log_info("writing yaml file : ", ymlfile)
GRP2 <- prolfquapp::make_DEA_config_R6(
  PROJECTID = opt$project,
  ORDERID = opt$order,
  WORKUNITID = opt$workunit,
  Normalization = opt$trans
  )
GRP2$set_zipdir_name()
if (!is.null(opt$outdir) && dir.exists(opt$outdir)) {
  GRP2$path <- opt$outdir
}
cfg <- prolfquapp::R6_extract_values(GRP2)
if (!dir.exists(opt$outdir)) {dir.create(opt$outdir)}
yaml::write_yaml(cfg, file = file.path(opt$outdir , ymlfile))

